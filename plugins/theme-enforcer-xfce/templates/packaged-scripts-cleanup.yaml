apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-scripts-configmap-cleanup
  annotations:
    argocd.argoproj.io/hook: PostDelete
data:
  bootstrap.sh: |
    #!/bin/bash
    echo "Unpacking scripts..."
    # decode base64 encoded scripts mount at /terra/scripts.base64
    base64 -d /terra/scripts.base64 > /terra/scripts.tar.gz
    
    # extract scripts to /terra/scripts
    tar -xzvf /terra/scripts.tar.gz -C /terra/
    
    # make scripts executable
    chmod +x -v /terra/scripts/*.sh
    
    # start entrypoint.sh
    cd /terra/scripts
    pwd
    ./entrypoint.sh
  packaged_scripts.base64: "H4sIAAAAAAAAA+3SzXKCMBAHcM48xarXiihEn6Hn9gUCREkbEiYfY337BtGx7dSb2kP/vxnITLKbLGxcbWXv3SK5ozzaMDaMyw3Lx7E4jmfJkuVFwcpVfJJ8uVqt1wmxexZ1FpznlijhqumqzqvrccK6RxT0WO7Uf6G9PfRGap+59sZnDA1el+XV/pds86P/LC+LhPIb1/Grf97/2WRRSb2ouGvT1AlPc5GKujU0fYn/xUu9o8vVoPG2ZFk2TdMZvbaCtkEpqo32McqR2ZKPk6dLRY20ovbGHmgvY1glYlLQPa/fRUPeHGPrYG3M/RLrW+7jS7rTPjHJBu1I6oye9bgiPnjXK/FEezHu/Rb7SEq6IXM45rKdM3QwgWquyQkxnnmul+smVrWTOmZUQapm+N4YbYnvhTOdoF6FuDxJlaO54ulftwsAAAAAAAAAAAAAAAAAAAAA4JtPvI5ahgAoAAA="