apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-scripts-configmap-cleanup
  annotations:
    argocd.argoproj.io/hook: PostDelete
data:
  bootstrap.sh: |
    #!/bin/bash
    echo "Unpacking scripts..."
    # decode base64 encoded scripts mount at /terra/scripts.base64
    base64 -d /terra/scripts.base64 > /terra/scripts.tar.gz
    
    # extract scripts to /terra/scripts
    tar -xzvf /terra/scripts.tar.gz -C /terra/
    
    # make scripts executable
    chmod +x -v /terra/scripts/*.sh
    
    # start entrypoint.sh
    cd /terra/scripts
    pwd
    ./entrypoint.sh
  packaged_scripts.base64: "H4sIAAAAAAAAA+3Sy3KCMBQGYNY8xVG3FfEGz9B1+wIhREkbEyaXsb59g+jY0V6mM9pOp/+3AIackwT+OG5l690kuaE8Ksvl/h6d3y+fp9NZXiS0vOWmjoLzzBIl1hj/Wd1X43+UO+TPG2b9jU7B9/OfzfMS+f+EY/5Ce7trjdQ+c82V1+hCLYrFh/kvluVZ/vOymCeUX3kf7/rn+Y8Gk0rqScVck6ZOeBqLVPDG0PAh/hcv9ZpOR4P605Jl2TBNR/TYCFoFpYgb7WOVI7MiH18eDhXV0grujd3RVsaySsSmoFvGn0VN3uxrebA29r6p9Q3z8SLdYZ7YZIN2JHVG97ofES9s0ypxR1vRz/0UcyQlXdfZLXOazhnamUCcaXJC9Gse98t0HXe1ljp2VEGquvveWG2JbYUzG0GtCnF4kCpHY8XS344LAAAAAAAAAAAAAAAAAAAA4MIrfu7x7gAoAAA="