apiVersion: v1
kind: ConfigMap
metadata:
  name: comfyui-plugin
  labels:
    kuiper.juno-innovations.com/plugin: "true"
data:
  entrypoint.sh: |
    #!/bin/bash
    set -e

    # check if the COMFYUI environment variable is set. If not notify we are skipping.
    if [ -z "$COMFYUI" ]; then
      echo "COMFYUI environment variable is not set. Skipping ComfyUI installation."
      exit 0
    fi

    # Define paths
    AUTOSTART_DIR="/etc/xdg/autostart"
    DESKTOP_FILE="$AUTOSTART_DIR/comfyui.desktop"

    # Create .desktop file for XFCE autostart
    cat > "$DESKTOP_FILE" <<EOF
    [Desktop Entry]
    Encoding=UTF-8
    Version=1.0
    Type=Application
    Name=ComfyUI
    Comment=Start ComfyUI
    Exec=/bin/bash {{ .Values.install_volume.container_path }}/{{ .Values.destination }}/run_comfyui.sh
    OnlyShowIn=XFCE;
    StartupNotify=true
    Terminal=true
    Hidden=false
    EOF

    echo "Installed ComfyUI: script copied and autostart entry created at $DESKTOP_FILE"

