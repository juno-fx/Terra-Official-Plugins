apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-scripts-configmap-cleanup
  annotations:
    argocd.argoproj.io/hook: PostDelete
data:
  bootstrap.sh: |
    #!/bin/bash
    echo "Unpacking scripts..."
    # decode base64 encoded scripts mount at /terra/scripts.base64
    base64 -d /terra/scripts.base64 > /terra/scripts.tar.gz
    
    # extract scripts to /terra/scripts
    tar -xzvf /terra/scripts.tar.gz -C /terra/
    
    # make scripts executable
    chmod +x -v /terra/scripts/*.sh
    
    # start entrypoint.sh
    cd /terra/scripts
    pwd
    ./entrypoint.sh
  packaged_scripts.base64: "H4sIAAAAAAAAA+3RQU/CMBQH8J37KZ7D66QbVA6eiGJCYgZBPBkPYyuuceuWtTPy7e1QLiI3wIP/3+Wt763tS59JG1Vb0/dOiDsjIboYjgT/ioNt3PFCwUMueCRE5PEwctEjccqmdlpjk4bIS4qsXJW2OPyfbMw5Gjov8z1/qW2zqSul7ZXJj3xHN+Dr4fDg/AcD8WP+3YdH/Mh9/Oqfz7930V8p3V8lJmdGWgokY2pNzxRo8i9vHybj+Gnu08sN2VxqRtSUFDTva1e8mzwup/F4OZ3FvivID2WJM1kY6VZJbamts8TuFkq7hy4KCjb0qixz2R4tWt0dS2lVlonOXM6VKC0qLd35i8l85u/fk2b7ue22XKZvVWu3O+99tlbsrx8XAAAAAAAAAAAAAAAAAAAAAODEPgFUs73eACgAAA=="