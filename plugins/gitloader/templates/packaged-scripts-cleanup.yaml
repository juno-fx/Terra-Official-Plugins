apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-scripts-configmap-cleanup
  annotations:
    argocd.argoproj.io/hook: PostDelete
data:
  bootstrap.sh: |
    #!/bin/bash
    echo "Unpacking scripts..."
    # decode base64 encoded scripts mount at /terra/scripts.base64
    base64 -d /terra/scripts.base64 > /terra/scripts.tar.gz
    
    # extract scripts to /terra/scripts
    tar -xzvf /terra/scripts.tar.gz -C /terra/
    
    # make scripts executable
    chmod +x -v /terra/scripts/*.sh
    
    # start entrypoint.sh
    cd /terra/scripts
    pwd
    ./entrypoint.sh
  packaged_scripts.base64: |
    H4sIAAAAAAAAA+2RS0+DQBDHOe+nGKlXZHmsaDw1ikkTQ5taT8YDhUU2wkLYwdhv70LlYmNPbTWR32VemUfmr5JG1Khs44hQTcBYZ52A0a31ejtgOIw6lFGXMdfQnuv6BrBjHjXQKowbAMPprtjD9ZV/inNOjfrSn0tsNnUlJF6o/MA7OoEvff9H/T2PfdPfDQKt/149DsU/139yZq+FtNexyoniCBYnRGTwDJYE8/z2IZxGTwsTXm4Acy4JQFOC1bxnungXPq5m0XQ1m0emLvAPgUAJLxTXUVwjtHUa4xAIqR9dFGBt4FUg0dkJLFvZjYWkKstYpjqnS5AUleR6/jJczM3dPUm6m+vbcp68VS32nfcmyQT57eeOjIyM/GE+AYJgKvkACgAA
  packaged_scripts.checksum: "0642d1b7787686ed0162c83c3c4f1cbebb0f07dec21a46f260605712f4e66e33"
