apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ .Release.Name }}-tooling"
data:
  system.sh: |
    #!/bin/sh
    set -e

    cd /usr/src/app

    addgroup -g "{{ .Values.guid }}" wettyusers

    adduser -D -u "{{ .Values.puid }}" -G wettyusers "{{ .Values.user }}"

    echo "{{ .Values.user }}:$USER_PASS" | chpasswd

    {{ if .Values.packages }}
    apk add {{ .Values.packages }}
    {{ end }}

    yarn start --base "/polaris/{{ .Values.name }}" --allow-iframe

